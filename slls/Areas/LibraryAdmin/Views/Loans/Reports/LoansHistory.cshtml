@using System.Linq
@using System.Web.Http.Results
@using slls.Models
@using Westwind.Globalization
@model slls.ViewModels.LoansReportsViewModel

@*@Html.Partial("_PrintHeader")*@
@*<script src="@Url.Content("~/Scripts/report-no-data.js")" type="text/javascript"></script>*@

@Html.Hidden("HasData", (string)Model.HasData.ToString())

@*The 'Print' and 'Close' part ...*@
<div class="noprint" style="float: right;">
    <div style="margin-top: 22px;">
        <button type="button" class="btn btn-primary" onclick="window.print();"><span aria-hidden="true" class="glyphicon glyphicon-print"></span> Print</button>
        &nbsp;&nbsp;&nbsp;&nbsp;<a href="@Url.Action("ItemBorrowingHistoryReport", "Loans")" title="Go back to choose different criteria" class="btn btn-link" data-toggle="modal" data-target="#lrgModal">Go Back</a>
        &nbsp;or&nbsp;&nbsp;<a href="@Url.Action("Index", "Home", new { area = "LibraryAdmin"})" title="@DbRes.T("Buttons.Close", "Terminology")">@DbRes.T("Buttons.Close", "Terminology")</a>
    </div>
</div>

<h2>@ViewBag.Title</h2>
<hr/>

@if (TempData["NoDataMsg"] != null)
{
    <div class="alert alert-danger alert-dismissible" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <span aria-hidden="true" class="glyphicon glyphicon-exclamation-sign"></span>
        <span class="sr-only">No Data!</span>
        @TempData["NoDataMsg"]
        <span class="pull-right"><a href="@Url.Action("ItemBorrowingHistoryReport", "Loans")" title="Back" data-toggle="modal" data-target="#lrgModal">Try again</a></span>
    </div>
}

@if (Model.Volumes.Any())
{

    <div class="row">
        <div class="col-md-12">
            <h4>@Html.DisplayFor(model => model.Title)</h4>
        </div>
    </div>

    <div class="row">
        <div class="col-md-10 col-md-push-1">
            <table class="table table-striped table-no-border">
                <thead>
                    <tr>
                        <th>@DbRes.T("Copies.Copy", "FieldDisplayName")</th>
                        <th>@DbRes.T("CopyItems.Label_Text", "FieldDisplayName")</th>
                        <th>@DbRes.T("CopyItems.Barcode", "FieldDisplayName")</th>
                        <th>@DbRes.T("Borrowing.Borrowed", "FieldDisplayName")</th>
                        <th>@DbRes.T("Borrowing.Date_Returned", "FieldDisplayName")</th>
                        <th>@DbRes.T("Borrowing.Borrowed_By", "FieldDisplayName")</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var copy in Model.Copies.OrderBy(c => c.CopyNumber))
                    {
                        foreach (var volume in Model.Volumes.Where(v => v.Borrowings.Any()).OrderBy(v => v.VolumeID))
                        {
                            foreach (var loan in volume.Borrowings.Where(b => b.Borrowed >= Model.StartDate && b.Borrowed <= Model.EndDate).OrderBy(x => x.Borrowed))
                            {
                                <tr>
                                    <td style="width: 10%;">@DbRes.T("Copies.Copy", "FieldDisplayName"): @Html.DisplayFor(modelItem => loan.Volume.Copy.CopyNumber)</td>
                                    <td style="width: 30%;">@Html.DisplayFor(modelItem => loan.Volume.LabelText)</td>
                                    <td style="width: 10%;">@Html.DisplayFor(modelItem => loan.Volume.Barcode)</td>
                                    <td style="width: 15%;">@Html.DisplayFor(modelItem => loan.Borrowed)</td>
                                    <td style="width: 15%;">@Html.DisplayFor(modelItem => loan.Returned)</td>
                                    <td style="width: 20%;">@Html.DisplayFor(modelItem => loan.BorrowerUser.Fullname)</td>
                                </tr>
                            }
                        }
                    }
                </tbody>
            </table>
            <div style="margin-bottom: 5px;">&nbsp;</div>
        </div>
    </div>


}