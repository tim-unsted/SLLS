@using System.Web.Http.Results
@using slls.Models
@using Westwind.Globalization
@model slls.ViewModels.LoansReportsViewModel

@Html.Partial("_PrintHeader")

<h2>@ViewBag.Title</h2>
<hr />

@if (Model.Titles.Any())
{
    foreach (var title in Model.Titles.OrderBy(t => t.Title1.Substring(t.NonFilingChars)))
    {
        <div class="row">
            <div class="col-md-12">
                <h4>@Html.DisplayFor(modelItem => title.Title1)</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-10 col-md-push-1">
                <table class="table table-striped table-no-border">
                    <thead>
                    <tr>
                        <th>@DbRes.T("Copies.Copy", "FieldDisplayName")</th>
                        <th>@DbRes.T("CopyItems.Label_Text", "FieldDisplayName")</th>
                        <th>@DbRes.T("CopyItems.Barcode", "FieldDisplayName")</th>
                        <th>@DbRes.T("Borrowing.Borrowed", "FieldDisplayName")</th>
                        <th>@DbRes.T("Borrowing.Date_Returned", "FieldDisplayName")</th>
                        <th>@DbRes.T("Borrowing.Borrowed_By", "FieldDisplayName")</th>
                    </tr>
                    </thead>
                    <tbody>
                        @foreach (var copy in title.Copies.OrderBy(c => c.CopyNumber))
                        {
                            foreach (var volume in copy.Volumes.Where(v => v.Borrowings.Any()).OrderBy(v => v.VolumeID))
                            {
                                foreach (var loan in volume.Borrowings.Where(b => b.Borrowed >= Model.StartDate && b.Borrowed <= Model.EndDate).OrderBy(x => x.Borrowed))
                                {
                                    <tr>
                                        <td style="width: 10%;">@DbRes.T("Copies.Copy", "FieldDisplayName"): @Html.DisplayFor(modelItem => loan.Volume.Copy.CopyNumber)</td>
                                        <td style="width: 30%;">@Html.DisplayFor(modelItem => loan.Volume.LabelText)</td>
                                        <td style="width: 10%;">@Html.DisplayFor(modelItem => loan.Volume.Barcode)</td>
                                        <td style="width: 20%;">@Html.DisplayFor(modelItem => loan.Borrowed)</td>
                                        <td style="width: 20%;">@Html.DisplayFor(modelItem => loan.Returned)</td>
                                        <td style="width: 30%;">@Html.DisplayFor(modelItem => loan.BorrowerUser.Fullname)</td>
                                    </tr>
                                }
                            }
                        }
                    </tbody>
                </table>
                <div style="margin-bottom: 5px;">&nbsp;</div>
            </div>
        </div>

    }
}